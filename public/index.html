<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>IAprova - Prepara√ß√£o Inteligente para Concursos P√∫blicos</title>
    <meta name="description" content="Sistema inteligente de prepara√ß√£o para concursos p√∫blicos com IA. Planos de estudo personalizados, gera√ß√£o de conte√∫do e muito mais!">
    <meta name="keywords" content="concursos p√∫blicos, estudo, prepara√ß√£o, IA, intelig√™ncia artificial, plano de estudos, flashcards, quest√µes">
    <meta name="author" content="IAprova">
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#6366f1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="IAprova">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="IAprova">
    <meta name="msapplication-TileColor" content="#6366f1">
    <meta name="msapplication-config" content="/browserconfig.xml">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://iaprova.app/">
    <meta property="og:title" content="IAprova - Prepara√ß√£o Inteligente para Concursos">
    <meta property="og:description" content="Estude de forma inteligente com IA. Planos personalizados, quest√µes no estilo da sua banca e muito mais!">
    <meta property="og:image" content="https://iaprova.app/icons/og-image.png">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://iaprova.app/">
    <meta property="twitter:title" content="IAprova - Prepara√ß√£o Inteligente para Concursos">
    <meta property="twitter:description" content="Estude de forma inteligente com IA. Planos personalizados, quest√µes no estilo da sua banca e muito mais!">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    
    <!-- Favicons -->
    <link rel="icon" type="image/svg+xml" href="/icons/favicon.svg">
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png">
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#122D6A">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Axios -->
    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"></script>
    
    <!-- Custom Styles -->
    <style>
        * {
            box-sizing: border-box;
        }
        
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            overscroll-behavior: none;
        }
        
        #app {
            min-height: 100vh;
            min-height: 100dvh;
        }
        
        /* Loading spinner */
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #122D6A;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Fade animations */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        
        /* Scale animation */
        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        .animate-scale-in {
            animation: scaleIn 0.3s ease-in-out;
        }
        
        /* Float animation */
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .animate-float {
            animation: float 3s ease-in-out infinite;
        }
        
        /* Pulse glow */
        @keyframes pulseGlow {
            0%, 100% { box-shadow: 0 0 20px rgba(18, 45, 106, 0.3); }
            50% { box-shadow: 0 0 40px rgba(18, 45, 106, 0.6); }
        }
        
        .pulse-glow {
            animation: pulseGlow 2s ease-in-out infinite;
        }
        
        /* Fade animation */
        @keyframes fade {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .animate-fade-in {
            animation: fade 0.3s ease-in-out;
        }
        
        /* Progress bar */
        .progress-bar {
            animation: progress 1s ease-in-out;
        }
        
        @keyframes progress {
            from { width: 0%; }
        }
        
        /* Hover effects */
        .hover-lift {
            transition: all 0.3s ease;
        }
        
        .hover-lift:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        /* Gradient text */
        .gradient-text {
            background: linear-gradient(135deg, #122D6A 0%, #1A3A7F 50%, #2A4A9F 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        /* Glass morphism */
        .glass {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
        
        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        
        /* Toast notifications */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 12px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 9999;
            animation: slideIn 0.3s ease-in-out;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .toast.success {
            background: #10b981;
        }
        
        .toast.error {
            background: #ef4444;
        }
        
        .toast.info {
            background: #3b82f6;
        }
    
        /* Estilos para banca */
        .banca-badge {
          background: linear-gradient(135deg, #122D6A 0%, #1A3A7F 100%);
          color: white;
          padding: 4px 12px;
          border-radius: 20px;
          font-size: 12px;
          font-weight: 600;
          display: inline-block;
          margin-left: 8px;
        }
        
        .banca-info {
          background-color: #f0f9ff;
          border-left: 4px solid #122D6A;
          padding: 12px;
          margin: 16px 0;
          border-radius: 4px;
        }
        
        /* PWA Install Banner */
        .pwa-install-banner {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, #122D6A 0%, #1A3A7F 100%);
            color: white;
            padding: 16px;
            z-index: 9998;
            transform: translateY(100%);
            transition: transform 0.3s ease;
        }
        
        .pwa-install-banner.show {
            transform: translateY(0);
        }
        
        /* Standalone mode adjustments */
        @media all and (display-mode: standalone) {
            body {
                padding-top: env(safe-area-inset-top);
                padding-bottom: env(safe-area-inset-bottom);
            }
        }
        
        /* iOS specific */
        @supports (-webkit-touch-callout: none) {
            body {
                min-height: -webkit-fill-available;
            }
        }
    </style>
</head>
<body>
    <!-- App Container -->
    <div id="app">
        <!-- Initial Loading Screen -->
        <div class="min-h-screen flex items-center justify-center bg-gradient-to-br from-[#0D1F4D] via-[#122D6A] to-[#1A3A7F]">
            <div class="text-center">
                <div class="mb-6 animate-float">
                    <!-- Logo IAprova -->
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 192 192" class="w-24 h-24 mx-auto pulse-glow rounded-3xl">
                        <defs>
                            <linearGradient id="grad1" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#1A3A7F"/>
                                <stop offset="100%" style="stop-color:#2A4A9F"/>
                            </linearGradient>
                        </defs>
                        <rect width="192" height="192" rx="40" fill="url(#grad1)"/>
                        <g transform="translate(40, 35) scale(0.55)">
                            <path d="M60 30 C30 30 20 60 20 90 C20 120 35 150 60 160 C70 165 80 165 90 160" fill="none" stroke="white" stroke-width="8" stroke-linecap="round"/>
                            <path d="M45 60 C35 65 30 80 35 95" fill="none" stroke="white" stroke-width="6" stroke-linecap="round"/>
                            <path d="M40 100 C35 110 40 125 55 130" fill="none" stroke="white" stroke-width="6" stroke-linecap="round"/>
                            <path d="M140 30 C170 30 180 60 180 90 C180 120 165 150 140 160 C130 165 120 165 110 160" fill="none" stroke="white" stroke-width="8" stroke-linecap="round"/>
                            <path d="M155 60 C165 65 170 80 165 95" fill="none" stroke="white" stroke-width="6" stroke-linecap="round"/>
                            <path d="M160 100 C165 110 160 125 145 130" fill="none" stroke="white" stroke-width="6" stroke-linecap="round"/>
                            <path d="M90 40 L110 40 M90 80 L110 80 M90 120 L110 120" fill="none" stroke="white" stroke-width="6" stroke-linecap="round"/>
                        </g>
                        <circle cx="145" cy="145" r="35" fill="#10B981"/>
                        <path d="M125 145 L140 160 L170 130" fill="none" stroke="white" stroke-width="8" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>
                <h1 class="text-white text-4xl font-bold mb-2">IAprova</h1>
                <p class="text-blue-200 text-lg mb-6">Prepara√ß√£o Inteligente para Concursos</p>
                <div class="spinner mx-auto mb-4"></div>
                <p class="text-blue-100 text-sm">Carregando sistema...</p>
            </div>
        </div>
    </div>
    
    <!-- PWA Install Banner (hidden by default) -->
    <div id="pwa-install-banner" class="pwa-install-banner">
        <div class="max-w-md mx-auto flex items-center justify-between gap-4">
            <div class="flex items-center gap-3">
                <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center">
                    <i class="fas fa-mobile-alt text-xl"></i>
                </div>
                <div>
                    <p class="font-bold">Instale o IAprova</p>
                    <p class="text-sm text-blue-200">Acesse como um app!</p>
                </div>
            </div>
            <div class="flex gap-2">
                <button onclick="dismissPWABanner()" class="px-3 py-2 text-sm opacity-70 hover:opacity-100">
                    Depois
                </button>
                <button onclick="installPWA()" class="px-4 py-2 bg-white text-[#122D6A] rounded-lg font-bold text-sm">
                    Instalar
                </button>
            </div>
        </div>
    </div>
    
    <!-- Main App Script -->
    <script src="/static/app.js" defer></script>
    
    <!-- PWA & Service Worker Registration -->
    <script>
        // Vari√°vel global para o prompt de instala√ß√£o
        let deferredPrompt = null;
        
        // Registrar Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', async () => {
                try {
                    const registration = await navigator.serviceWorker.register('/sw.js', {
                        scope: '/'
                    });
                    console.log('‚úÖ Service Worker registrado:', registration.scope);
                    
                    // Verificar atualiza√ß√µes
                    registration.addEventListener('updatefound', () => {
                        console.log('üîÑ Nova vers√£o do Service Worker encontrada');
                    });
                } catch (error) {
                    console.log('‚ö†Ô∏è Service Worker n√£o registrado:', error);
                }
            });
        }
        
        // Capturar evento de instala√ß√£o PWA
        window.addEventListener('beforeinstallprompt', (e) => {
            console.log('üì± PWA pode ser instalado');
            e.preventDefault();
            deferredPrompt = e;
            
            // Verificar se j√° foi dismissado recentemente
            const dismissed = localStorage.getItem('pwa-banner-dismissed');
            const dismissedTime = dismissed ? parseInt(dismissed) : 0;
            const oneDay = 24 * 60 * 60 * 1000;
            
            if (!dismissed || (Date.now() - dismissedTime > oneDay)) {
                // Mostrar banner ap√≥s 3 segundos
                setTimeout(() => {
                    showPWABanner();
                }, 3000);
            }
        });
        
        // Detectar se j√° est√° instalado como PWA
        window.addEventListener('appinstalled', () => {
            console.log('‚úÖ IAprova instalado como PWA!');
            deferredPrompt = null;
            hidePWABanner();
            
            // Mostrar toast de sucesso
            if (typeof showToast === 'function') {
                showToast('üéâ IAprova instalado com sucesso!', 'success');
            }
        });
        
        // Fun√ß√µes do banner de instala√ß√£o
        function showPWABanner() {
            const banner = document.getElementById('pwa-install-banner');
            if (banner && deferredPrompt) {
                banner.classList.add('show');
            }
        }
        
        function hidePWABanner() {
            const banner = document.getElementById('pwa-install-banner');
            if (banner) {
                banner.classList.remove('show');
            }
        }
        
        function dismissPWABanner() {
            hidePWABanner();
            localStorage.setItem('pwa-banner-dismissed', Date.now().toString());
        }
        
        async function installPWA() {
            if (!deferredPrompt) {
                // Mostrar instru√ß√µes manuais
                showManualInstallInstructions();
                return;
            }
            
            deferredPrompt.prompt();
            const { outcome } = await deferredPrompt.userChoice;
            
            console.log('üì± Resultado da instala√ß√£o:', outcome);
            
            if (outcome === 'accepted') {
                console.log('‚úÖ Usu√°rio aceitou instalar');
            }
            
            deferredPrompt = null;
            hidePWABanner();
        }
        
        function showManualInstallInstructions() {
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
            const isAndroid = /Android/.test(navigator.userAgent);
            
            let instructions = '';
            
            if (isIOS) {
                instructions = `
                    <p class="mb-4">Para instalar o IAprova no iPhone/iPad:</p>
                    <ol class="list-decimal list-inside space-y-2 text-left">
                        <li>Toque no bot√£o <strong>Compartilhar</strong> <i class="fas fa-share-square"></i></li>
                        <li>Role e toque em <strong>"Adicionar √† Tela de In√≠cio"</strong></li>
                        <li>Toque em <strong>"Adicionar"</strong></li>
                    </ol>
                `;
            } else if (isAndroid) {
                instructions = `
                    <p class="mb-4">Para instalar o IAprova no Android:</p>
                    <ol class="list-decimal list-inside space-y-2 text-left">
                        <li>Toque no menu <strong>‚ãÆ</strong> (tr√™s pontos) do navegador</li>
                        <li>Toque em <strong>"Adicionar √† tela inicial"</strong> ou <strong>"Instalar app"</strong></li>
                        <li>Confirme tocando em <strong>"Adicionar"</strong></li>
                    </ol>
                `;
            } else {
                instructions = `
                    <p class="mb-4">Para instalar o IAprova:</p>
                    <ol class="list-decimal list-inside space-y-2 text-left">
                        <li>Clique no √≠cone de instala√ß√£o <i class="fas fa-plus-square"></i> na barra de endere√ßos</li>
                        <li>Ou acesse o menu do navegador e clique em <strong>"Instalar IAprova"</strong></li>
                    </ol>
                `;
            }
            
            // Criar modal com instru√ß√µes
            const modal = document.createElement('div');
            modal.id = 'install-instructions-modal';
            modal.className = 'fixed inset-0 bg-black/60 flex items-center justify-center z-[10000] p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-2xl p-6 max-w-sm w-full text-center">
                    <div class="w-16 h-16 bg-[#122D6A] rounded-2xl flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-mobile-alt text-white text-2xl"></i>
                    </div>
                    <h3 class="text-xl font-bold text-gray-800 mb-4">Instalar IAprova</h3>
                    <div class="text-gray-600 text-sm">
                        ${instructions}
                    </div>
                    <button onclick="document.getElementById('install-instructions-modal').remove()" 
                        class="mt-6 w-full py-3 bg-[#122D6A] text-white rounded-xl font-bold">
                        Entendi
                    </button>
                </div>
            `;
            document.body.appendChild(modal);
            hidePWABanner();
        }
        
        // Expor fun√ß√£o globalmente para uso no app.js
        window.showPWAInstallPrompt = installPWA;
        window.showManualInstallInstructions = showManualInstallInstructions;
        
        // Check if app.js is loaded
        window.addEventListener('error', function(e) {
            if (e.filename && e.filename.includes('app.js')) {
                console.error('Erro ao carregar app.js:', e);
                const script = document.createElement('script');
                script.src = './static/app.js';
                script.defer = true;
                document.body.appendChild(script);
            }
        });
        
        // Ensure DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                console.log('DOM carregado, aguardando app.js...');
            });
        } else {
            console.log('DOM j√° est√° pronto');
        }
    </script>
</body>
</html>
